user                         root admin;
worker_processes             2;

events {
    worker_connections       1024;
}

http {
    include       			 mime.types;
    default_type             text/html;
	gzip                     on;
	gzip_types               text/css text/x-component application/x-javascript application/javascript text/javascript text/x-js text/richtext image/svg+xml text/plain text/xsd text/xsl text/xml image/x-icon;
    
    sendfile                 on;
	
	# All servers redirect to SSL
	# server {
	#     listen 443;
	#     server_name api.commuteapp.io.com commuteapp.io;
	#     return 301 https://$host$request_uri;
	# }
	
	server {
	   listen       443 ssl;
	   server_name  api.commuteapp.io;

	   ssl on;
	   ssl_certificate		"/Users/daniel/Google Drive/Certificates/splendidbits/api.commuteapp.io/api.commuteapp.io.crt";
	   ssl_certificate_key	"/Users/daniel/Google Drive/Certificates/splendidbits/api.commuteapp.io/api.commuteapp.io.key";

	   ssl_session_cache    shared:SSL:1m;
	   ssl_session_timeout  5m;

	   ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
	   ssl_ciphers  HIGH:!aNULL:!MD5;
	   ssl_prefer_server_ciphers  on;
	   
	   # add_header Public-Key-Pins '\
	   # pin-sha1="FVMIiFT2pCuRq5wCMVEN1d6mDqo="; # api.commuteapp.io base64.
	   # pin-sha1="JCI+S9cFXU0QdW+0tgGSlYk9jwM="; # Splendid Bits Root CA base64 backup.
	   # pin-sha1="Zq0eHXKrfAwvw7WOcCkJoEQtOQ="; # Splendid Bits Root CA base64 backup.
	   # max-age=31536000 includeSubdomains';

		location / {
			proxy_set_header Host api.commuteapp.io;
			proxy_pass http://127.0.0.1:9000; 
	        port_in_redirect off;
			proxy_connect_timeout 300;
		}
    }

	server {
		listen               7888 default_server;

		# MAMP DOCUMENT_ROOT !! Don't remove this line !!
		root                 "/Applications/MAMP/htdocs";

		access_log           /Applications/MAMP/logs/nginx_access.log;
		error_log            /Applications/MAMP/logs/nginx_error.log debug;
		
		location /septa_instant {
			alias /Applications/MAMP/htdocs/septa_instant;
			fastcgi_pass     unix:/Applications/MAMP/Library/logs/fastcgi/nginxFastCGI.sock;
			fastcgi_param    SCRIPT_FILENAME $document_root$fastcgi_script_name;
			fastcgi_read_timeout 1000; 
			autoindex on;
		}
	
		location ~* /MAMP/(.*)$ {
			root             /Applications/MAMP/bin;
			index            index.php;

			location ~ \.php$ {
				try_files        $uri =404;
				fastcgi_pass     unix:/Applications/MAMP/Library/logs/fastcgi/nginxFastCGI.sock;
				fastcgi_param    SCRIPT_FILENAME $document_root$fastcgi_script_name;
				include          fastcgi_params;
			}
		}

		location ~* /phpMyAdmin(.*)$ {
			root             /Applications/MAMP/bin;
			index            index.php;

			location ~ \.php$ {
				try_files        $uri =404;
				fastcgi_pass     unix:/Applications/MAMP/Library/logs/fastcgi/nginxFastCGI.sock;
				fastcgi_param    SCRIPT_FILENAME $document_root$fastcgi_script_name;
				include          fastcgi_params;
			}
		}

		location ~* /phpPgAdmin(.*)$ {
			root             /Applications/MAMP/bin;
			index            index.php;

			location ~ \.php$ {
				try_files        $uri =404;
				fastcgi_pass     unix:/Applications/MAMP/Library/logs/fastcgi/nginxFastCGI.sock;
				fastcgi_param    SCRIPT_FILENAME $document_root$fastcgi_script_name;
				include          fastcgi_params;
			}
		}
		
		location ~* /phpLiteAdmin(.*)$ {
			root             /Applications/MAMP/bin;
			index            index.php;

			location ~ \.php$ {
				try_files        $uri =404;
				fastcgi_pass     unix:/Applications/MAMP/Library/logs/fastcgi/nginxFastCGI.sock;
				fastcgi_param    SCRIPT_FILENAME $document_root$fastcgi_script_name;
				include          fastcgi_params;
			}
		}
		
		location ~* /SQLiteManager(.*)$ {
			root             /Applications/MAMP/bin;
			index            index.php;

			location ~ \.php$ {
				try_files        $uri =404;
				fastcgi_pass     unix:/Applications/MAMP/Library/logs/fastcgi/nginxFastCGI.sock;
				fastcgi_param    SCRIPT_FILENAME $document_root$fastcgi_script_name;
				include          fastcgi_params;
			}
		}
		
		location /icons {
			alias /Applications/MAMP/Library/icons;
			autoindex on;
		}
		
		location /favicon.ico {
			alias /Applications/MAMP/bin/favicon.ico;
            # log_not_found off;
            # access_log off;
		}

		location ~ \.php$ {
			try_files        $uri =404;
			fastcgi_pass     unix:/Applications/MAMP/Library/logs/fastcgi/nginxFastCGI.sock;
			fastcgi_param    SCRIPT_FILENAME $document_root$fastcgi_script_name;
			include          fastcgi_params;
		}

		location ~ /\. {
			deny all;
		}

		# location ~* \.(gif|jpg|png|pdf)$ {
        #	expires          30d;
		# }

   		# location = /robots.txt {
        #	allow all;
        #	log_not_found off;
        #	access_log off;
   		# }

	    # location ~* \.(txt|log)$ {
        #	allow 127.0.0.1;
        #	deny all;
   		# }
   		
   		# location ~ \..*/.*\.php$ {
        #	return 403;
   		# }

		location /nginx_status {
			stub_status      on;
			access_log       off;
			allow            127.0.0.1;
			deny			 all;
		}
	}
}
